<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เอกสารขั้นตอนการสร้าง CRUD API สำหรับจัดการสินค้าด้วย Laravel</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: #2c3e50; }
        h1 { border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #ecf0f1; padding-bottom: 8px; }
        code { background-color: #ecf0f1; padding: 2px 5px; border-radius: 4px; font-family: "Courier New", Courier, monospace; }
        pre { background-color: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; overflow-x: auto; }
        pre code { background-color: transparent; padding: 0; }
        li { margin-bottom: 10px; }
        hr { border: 0; height: 1px; background: #ecf0f1; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>เอกสารขั้นตอนการสร้าง CRUD API สำหรับจัดการสินค้าด้วย Laravel</h1>
    <p>เอกสารนี้อธิบายขั้นตอนการสร้าง RESTful API สำหรับการจัดการข้อมูลสินค้า (มือถือ) โดยใช้ Laravel Framework, ฐานข้อมูล SQLite, และสร้างเอกสารประกอบ API ด้วย Swagger (l5-swagger)</p>

    <p><strong>หมายเหตุ</strong>: คำสั่งบางอย่าง เช่น <code>php artisan key:generate</code>, <code>touch database/database.sqlite</code>, <code>php artisan migrate</code> และ <code>php artisan db:seed</code> อาจถูกรันโดยอัตโนมัติระหว่างการตั้งค่าสภาพแวดล้อมหรือเมื่อโปรเจกต์ถูกสร้างขึ้นครั้งแรก</p>

    <h2>1. การตั้งค่าโปรเจกต์และฐานข้อมูล</h2>
    <p>เริ่มต้นจากการสร้างโปรเจกต์ Laravel และตั้งค่าให้ใช้ฐานข้อมูล SQLite</p>

    <h3>1.1. ตั้งค่าการเชื่อมต่อฐานข้อมูล</h3>
    <p>ตรวจสอบและกำหนดค่าในไฟล์ <code>.env</code> เพื่อให้แน่ใจว่า Laravel จะใช้ <code>sqlite</code> เป็นตัวเชื่อมต่อฐานข้อมูล</p>
    <pre><code>DB_CONNECTION=sqlite</code></pre>

    <h3>1.2. สร้าง Application Key</h3>
    <p>Laravel ต้องการ Application Key สำหรับการเข้ารหัสข้อมูล หากยังไม่มี สามารถสร้างได้ด้วยคำสั่ง:</p>
    <pre><code>php artisan key:generate</code></pre>
    <p>คำสั่งนี้จะสร้างคีย์ที่ไม่ซ้ำกันและบันทึกลงในไฟล์ <code>.env</code> โดยอัตโนมัติ</p>

    <h3>1.3. สร้างไฟล์ฐานข้อมูล</h3>
    <p>สร้างไฟล์ฐานข้อมูลเปล่าๆ ขึ้นมาในไดเรกทอรี <code>database/</code> สำหรับ SQLite</p>
    <pre><code>touch database/database.sqlite</code></pre>
    <p>คำสั่งนี้จะสร้างไฟล์ <code>database.sqlite</code> เปล่าๆ ขึ้นมา เพื่อให้ Laravel สามารถเชื่อมต่อและสร้างตารางได้</p>

    <h2>2. การสร้างตารางสินค้า (Products)</h2>
    <p>ใช้ Artisan command ของ Laravel เพื่อสร้างไฟล์ Migration สำหรับตาราง <code>products</code></p>

    <h3>2.1. สร้าง Migration</h3>
    <pre><code>php artisan make:migration create_products_table --create=products</code></pre>

    <h3>2.2. แก้ไขไฟล์ Migration</h3>
    <p>เพิ่มคอลัมน์ <code>name</code> (ชื่อสินค้า) และ <code>price</code> (ราคา) ในไฟล์ migration ที่เพิ่งสร้างขึ้น (<code>database/migrations/xxxx_xx_xx_xxxxxx_create_products_table.php</code>)</p>
    <pre><code>// ...
public function up(): void
{
    Schema::create('products', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->decimal('price', 8, 2);
        $table->timestamps();
    });
}
// ...</code></pre>

    <h3>2.3. รัน Migration</h3>
    <p>สั่งให้ Laravel สร้างตารางในฐานข้อมูลตามโครงสร้างที่กำหนดในไฟล์ migration</p>
    <pre><code>php artisan migrate</code></pre>
    <p>คำสั่งนี้จะรันไฟล์ migration ทั้งหมดที่ยังไม่ได้รันในโปรเจกต์ และสร้างตาราง <code>products</code> รวมถึงตารางอื่นๆ ที่ Laravel ต้องการ</p>

    <h2>3. สร้าง Model และ Controller</h2>

    <h3>3.1. สร้าง Product Model</h3>
    <p>สร้าง Eloquent Model ชื่อ <code>Product</code> เพื่อใช้เป็นตัวแทนของข้อมูลในตาราง <code>products</code></p>
    <pre><code>php artisan make:model Product</code></pre>
    <p>จากนั้นกำหนด <code>fillable</code> property ใน <code>app/Models/Product.php</code> เพื่ออนุญาตให้บันทึกข้อมูลลงฟิลด์ <code>name</code> และ <code>price</code> ได้</p>
    <pre><code>// app/Models/Product.php
class Product extends Model
{
    use HasFactory;
    protected $fillable = ['name', 'price'];
}</code></pre>

    <h3>3.2. สร้าง ProductController</h3>
    <p>สร้าง Controller สำหรับจัดการ Logic ของ API ทั้งหมด</p>
    <pre><code>php artisan make:controller ProductController --api</code></pre>
    <p>จากนั้น เพิ่มเมธอดสำหรับ CRUD operations (index, store, show, update, destroy) ใน <code>app/Http/Controllers/ProductController.php</code></p>

    <h2>4. กำหนดเส้นทาง (API Routes)</h2>

    <h3>4.1. สร้างไฟล์ API Routes</h3>
    <p>สร้างไฟล์ <code>routes/api.php</code> และกำหนด <code>apiResource</code> route เพื่อเชื่อมโยง HTTP requests ไปยังเมธอดต่างๆ ใน <code>ProductController</code></p>
    <pre><code>// routes/api.php
use App\Http\Controllers\ProductController;
// ...
Route::apiResource('products', ProductController::class);</code></pre>

    <h3>4.2. ลงทะเบียน API Routes</h3>
    <p>ในไฟล์ <code>bootstrap/app.php</code> ต้องทำการเพิ่ม <code>api</code> route file เข้าไปในการตั้งค่า <code>withRouting</code></p>
    <pre><code>// bootstrap/app.php
return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        api: __DIR__.'/../routes/api.php', // เพิ่มบรรทัดนี้
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    // ...</code></pre>

    <h2>5. การสร้างข้อมูลตัวอย่าง (Database Seeding)</h2>

    <h3>5.1. สร้าง Seeder</h3>
    <p>สร้าง <code>ProductSeeder</code> เพื่อเพิ่มข้อมูลตัวอย่างลงในฐานข้อมูล</p>
    <pre><code>php artisan make:seeder ProductSeeder</code></pre>
    <p>แก้ไขไฟล์ <code>database/seeders/ProductSeeder.php</code> เพื่อเพิ่มข้อมูลสินค้าตัวอย่าง</p>

    <h3>5.2. รัน Seeder</h3>
    <p>สั่งให้ Laravel นำข้อมูลตัวอย่างเข้าสู่ฐานข้อมูล</p>
    <pre><code>php artisan db:seed</code></pre>
    <p>คำสั่งนี้จะรัน Seeder ที่กำหนดไว้ใน <code>DatabaseSeeder.php</code> หรือรัน Seeder ที่ระบุโดยตรง เพื่อใส่ข้อมูลเริ่มต้นลงในตาราง เช่น ข้อมูลสินค้าตัวอย่าง</p>

    <h2>6. การสร้างเอกสาร API ด้วย Swagger</h2>

    <h3>6.1. ติดตั้ง l5-swagger</h3>
    <p>ใช้ Composer เพื่อติดตั้ง package <code>darkaonline/l5-swagger</code></p>
    <pre><code>composer require "darkaonline/l5-swagger"</code></pre>

    <h3>6.2. Publish ไฟล์ตั้งค่า</h3>
    <pre><code>php artisan vendor:publish --provider "L5Swagger\L5SwaggerServiceProvider"</code></pre>

    <h3>6.3. เพิ่ม Annotations</h3>
    <p>เพิ่ม OpenAPI (Swagger) annotations ใน Controller และ Model เพื่ออธิบายรายละเอียดของ API</p>
    <ul>
        <li><strong><code>app/Http/Controllers/Controller.php</code></strong>: เพิ่ม <code>@OA\Info</code> เพื่อกำหนดข้อมูลโดยรวมของ API</li>
        <li><strong><code>app/Http/Controllers/ProductController.php</code></strong>: เพิ่ม <code>@OA\Get</code>, <code>@OA\Post</code>, <code>@OA\Put</code>, <code>@OA\Delete</code> ในแต่ละเมธอดเพื่ออธิบาย endpoint</li>
        <li><strong><code>app/Models/Product.php</code></strong>: เพิ่ม <code>@OA\Schema</code> และ <code>@OA\Property</code> เพื่ออธิบายโครงสร้างข้อมูลของ Product</li>
    </ul>

    <h3>6.4. สร้างเอกสาร</h3>
    <p>รันคำสั่งเพื่อสร้างไฟล์เอกสาร Swagger</p>
    <pre><code>php artisan l5-swagger:generate</code></pre>

    <h2>7. ทดสอบ API และดูเอกสาร</h2>
    <p>สุดท้าย รันเซิร์ฟเวอร์เพื่อทดสอบ</p>
    <pre><code>php artisan serve</code></pre>
    <ul>
        <li><strong>API Endpoints</strong>: <code>http://localhost:8000/api/products</code></li>
        <li><strong>Swagger Documentation</strong>: <code>http://localhost:8000/api/documentation</code></li>
    </ul>
    <hr>
</body>
</html>
